<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">

  <title>MarkTexting</title>
  <script src="../../static/js/echarts.js"></script>
  <script src="../../static/js/jquery.js"></script>
  <script src="../../static/js/dataTool.min.js"></script>
  <script src='../../static/js/cb_entitylist.js'></script>

  <link rel="stylesheet" href="../../static/css/style.css" media="screen" type="text/css" />

</head>

<body>

  <span class='bckg'></span>
<header>
  <h1>
    Dashboard
  </h1>
  <nav id="mymenu">
    <ul>
      <li>
        <a target="_top" href="/index" data-title='Text'>Text</a>
      </li>
      <li>
        <a target="_top" href="/mgraph" data-title='Graph'>Graph</a>
      </li>
      <li>
        <a data-title='Entity'>Entity</a>
      </li>
        <ul id = "submene"></ul>
      <li>
        <a data-title='Import'>Import</a>
      </li>
      <li>
        <a data-title='Export'>Export</a>
      </li>
      <li>
        <a data-title='Invite'>Invite</a>
      </li>
    </ul>
  </nav>
</header>
<main>
  <div class='title'>
    <h2>Graph</h2>
    <a href='/user/info' title='UserCenter' id='mytitle'></a>
  </div>
  <div id="main" style="width: 100%;height:150%;"></div>
  <script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'),'dark');
    myChart.showLoading();
    $.get('/api/project/graph', function (xml) {
      myChart.hideLoading();

      var graph = JSON.parse(xml);
      var categories = [];
      for (var i = 0; i < 9; i++) {
          categories[i] = {
              name: 'Class ' + i
          };
      }
      graph.nodes.forEach(function (node) {
          node.itemStyle = null;
          node.value = node.symbolSize;
          node.symbolSize /= 1.5;
          node.label = {
              show: true
          };
          node.category = Math.floor(node.symbolSize*0.15);
          node.draggable = true;
      });
      option = {
          title: {
              text: 'Go',
              subtext: 'Default layout',
              top: 'bottom',
              left: 'right'
          },
          tooltip: {
            trigger: 'item',
            formatter: function (params) {
              if (params.data.source) {
                return params.data.name;
              }
              else {
                return params.data.name;
              }
            }
          },
          legend: [{
              // selectedMode: 'single',
              data: categories.map(function (a) {
                  return a.name;
              })
          }],
          animationDuration: 1500,
          animationEasingUpdate: 'quinticInOut',
          series : [
              {
                  //name: 'aName',
                  type: 'graph',
                  layout: 'force',
                  data: graph.nodes,
                  links: graph.links,
                  categories: categories,
                  roam: true,
                  focusNodeAdjacency: true,
                  itemStyle: {
                      borderColor: '#fff',
                      borderWidth: 1,
                      shadowBlur: 10,
                      shadowColor: 'rgba(0, 0, 0, 0.3)'
                  },
                  label: {
                      position: 'right',
                      formatter: '{b}'
                  },
                  lineStyle: {
                      color: 'source',
                      curveness: 0.3,
                      width:5
                  },
                  emphasis: {
                      lineStyle: {
                          width: 10
                      }
                  },
                  force: {
                  repulsion: 100
                  }
              }
          ]
      };
      myChart.setOption(option);
    }, 'text');
    myChart.on('click', function (params) {
        if (params.dataType == 'node') {
            go = "/index";
            window.open(go);
        }
        if (params.dataType == 'edge') {
        alert(params.dataType + ' ' + params.data.name);
        }
    });
  </script>
</main>

  <script src='../../static/js/jquery.js'></script>

</body>
<script type="text/javascript" src="../../static/js/jquery.min.js"></script>
<script type="text/javascript">
  window.onload = function() {
    Reload();
    getUserInfo();
  }
  function Reload() {
    $.ajax({
        type:"GET",
        url:"/api/project/graph",
        success: function (data) {},
        error: function(data) {
          var json = JSON.parse(data.responseText);
          alert(json.msg);
          if (json.ret == 302) {
            window.location.href = json.redirect;
          }
        }
      })
  }
  function getUserInfo() {
    $.ajax({
      type:"GET",
      url:"/user/other",
      contentType: "application/json",
      success: function (data) {
        if (data.ret == 0) {
          console.log(data);
          $('#mytitle').html(data.user_name);
        } else {
          console.log(data);
        }
      },
    })
  }
</script>
</html>
